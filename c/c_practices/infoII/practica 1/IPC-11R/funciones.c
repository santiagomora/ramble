/**********************************************************************************************************************************
 *
 * @file		funciones.c
 * @brief		Descripcion del modulo
 * @date		02-05-2020
 * @author		Luis Mora
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "funciones.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/**
    \fn     imprimemem
    \brief  imprime valores almacenados en memoria compartida
    \author Luis Mora
    \date 02-05-2020
    \param [in] mem direccion de memoria compartida;
*/
void imprimemem( int* mem ){
    int sum=0;
    printf( "VALORES ALMACENADOS\n" );
    for (int ctr =0; ctr<SHMSIZE; ctr++){
        printf("valor[%d]: %d\n",ctr+1,mem[ctr]);
        sum+=mem[ctr];
    }
    printf("-----------------------------\n");
    printf("SUMATORIA: %d\n",sum);
}

/**
    \fn     cambia
    \brief  reemplaza por el nuevo valor e imprime memoria
    \author Luis Mora
    \date 02-05-2020
    \param [in] int shid el id de la memoria compartida
    \param [in] int pos la  posicion a cambiar
    \param [in] int val el nuevo valor
    \return 0 si hay exito, 1 si error;
*/
int cambia( int shid,int pos,int val ){
    int* mem = ( int* ) enganchashm( shid,NULL,0 );
    printf("MEMORIA COMPARTIDA LEIDA\n");
    mem[pos] = val;
    printf("MEMORIA COMPARTIDA MODIFICADA: MEM[%d] = %d.\n",pos,val);
    imprimemem( mem );
    desenganchashm( mem );
    return 0;
}

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/

/**
    \fn     conecta
    \brief  crea la memoria compartida
    \author Luis Mora
    \date 02-05-2020
    \param [in] int pos la posicion que cambiaremos
    \param [in] int val el valor nuevo
    \return 0 si hay exito, 1 si hay un error;
*/
int conecta( int pos,int val ){
    int shid = conectashm(KEYFILE,PRKEY,SHMSIZE*sizeof( int ),0);
    cambia( shid,pos-1,val );
    return 0;
}

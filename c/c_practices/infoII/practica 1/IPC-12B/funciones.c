/**********************************************************************************************************************************
 *
 * @file		funciones.c
 * @brief		Descripcion del modulo
 * @date		02-05-2020
 * @author		Luis Mora
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "funciones.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/**
    \fn     chequea
    \brief  imprime "TENGO ACCESO" cuando el semaforo
            creado en IPC-12B esta en estado 0. Ignora errores
            al hacer semctl y semid.
    \author Luis Mora
    \date 02-05-2020
    \param [in] el id del semaforo
    \return 0 si hay exito, 1 si hay un error;
*/
int chequea( int semid ){
    while ( 1 ){
        if ( operasem( semid,SEMPOS,GETVAL )==0 ){
           printf("TENGO ACCESO\n");
           sleep(1);
        }
    }
    return 0;
}

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/

/**
    \fn     conectaSEM
    \brief  crea la llave
    \author Luis Mora
    \date 02-05-2020
    \param [in]
    \param [out]
    \return 0 si hay exito, 1 si hay un error;
*/
int conecta( ){
    int semid = creasem( KEYFILE,PRKEY,0,CANTSEMS );
    chequea( semid );
    return 0;
}

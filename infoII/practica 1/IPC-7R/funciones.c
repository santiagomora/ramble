/**********************************************************************************************************************************
 *
 * @file		funciones.c
 * @brief		Descripcion del modulo
 * @date		02-05-2020
 * @author		Luis Mora
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "funciones.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/
int fd;
/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/
/**
    \fn     inthandler
    \brief  elimina el fifo cuando hay una interrupcion
    \author Luis Mora
    \date 02-05-2020
    \return 0 si hay exito, 1 si hay un error;
*/
void inthandler( int sig ){
    cierrafifo( FIFOPATH,fd );
}

/**
    \fn     recibir
    \brief  lee valores de la fifo
    \author Luis Mora
    \date 02-05-2020
    \return 0 si hay exito, 1 si hay error de lectura;
*/
int recibir( int fd, int size ){
    ssize_t sz;
    char buf[size];
    if( ( sz = leefd( fd,buf,size ) )>0 ){
        buf[sz] = '\0';
        printf( "Mensaje recibido:\n\t %s\n",buf );
    }
    return 0;
}

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/
/**
    \fn     abrir
    \brief  Abre el FIFO y lo elimina al terminar
    \author Luis Mora
    \date 02-05-2020
    \return 0 si hay exito, 1 si hay error de apertura o cierre;
*/
int abrir( ){
    signal( SIGINT,inthandler );
    fd = abrefifo( FIFOPATH,O_RDONLY );
    recibir( fd,BUFSIZE );
    cierrafifo( FIFOPATH,fd );
    return 0;
}

